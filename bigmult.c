/* Perform efficient multiplication of big numbers
 * Julien Vehent July 2012
 * gcc -DDEBUG -Wall -o bigmult0.2 bigmult0.2.c
 *
 * Example:
 *
 * $ time ./bigmult 851822638561659673761719014739037733547729179448079350522246590213865673090975196774171716085429795939833555728676961545876061352174506331342057551475325448118606432961705636726702648556827376142320876820419220707457634622722589937002921569191171733939735382079197514895279990872548075873204447856277090252441906492777387939740584137950622912349831689678154914744049186201136904442518400182718612479568944285731988781388539536203787675462692881267328112581617105361897728795078172446614304260579289623008306511355560356481123981314792001049852352357469929563042362499198417059721591002521222913787378065840239693474520929806588407559940720710947630633584267322623534824635167472063194428553639877544860524549244759778174421667809779762745282401007268316099290523119484871684408632995768155807247981065214563132008289937343512544877197781175024616387173827107248666473011556504774877067251330034550916011823476146043323511278743865010779404288949799187544674350095250882775800295343347418886633729335817875941086514814804963724916918883259066351942234347823834772405298444429141922722177523983666232033961605308204927987907077789470022233918253897906488623816607931512163241498943735070206381165409393741182967532506865663966918446087370730017163098905581486447565904416039257554646784071635301616058419744521692924374816723129640515619185219371842663960613220531477089578813270454275386107325644867937745527097830989493286286415996781592452700408052208123192711606989630675140647562336673601660146557288999980121446607416674692876583762027139935596727123826407518096021547369275045756108019504547728660228811757349328191062211230954792707685874002632942441843714644403502273942182055404007256356990487212359705697654661936602760579646372792445091367967451677285533064555257520693340235124505269607245401539991045951744101543845443660197897103403404992492763853284861589205734809438139095697791958025189819762443744750897637572569926328355504544287665120754932761983261039049134747095142587974064883181623482701656829569086782734728221339035051875652864338522590020070281543971416810282330763624637401022934617700104134698570936867090715760802403189157701981022852524054252970887118457447923476826583464395590842455635964003554896687005304948791811829113211911125879352210974916167186754856728987336998705890579457015583334507877535471765147227650950348162419064978217940779348955772444498990503692635443590505589325405634755362529382391250431787925548793273908203697 851822638561659673761719014739037733547729179448079350522246590213865673090975196774171716085429795939833555728676961545876061352174506331342057551475325448118606432961705636726702648556827376142320876820419220707457634622722589937002921569191171733939735382079197514895279990872548075873204447856277090252441906492777387939740584137950622912349831689678154914744049186201136904442518400182718612479568944285731988781388539536203787675462692881267328112581617105361897728795078172446614304260579289623008306511355560356481123981314792001049852352357469929563042362499198417059721591002521222913787378065840239693474520929806588407559940720710947630633584267322623534824635167472063194428553639877544860524549244759778174421667809779762745282401007268316099290523119484871684408632995768155807247981065214563132008289937343512544877197781175024616387173827107248666473011556504774877067251330034550916011823476146043323511278743865010779404288949799187544674350095250882775800295343347418886633729335817875941086514814804963724916918883259066351942234347823834772405298444429141922722177523983666232033961605308204927987907077789470022233918253897906488623816607931512163241498943735070206381165409393741182967532506865663966918446087370730017163098905581486447565904416039257554646784071635301616058419744521692924374816723129640515619185219371842663960613220531477089578813270454275386107325644867937745527097830989493286286415996781592452700408052208123192711606989630675140647562336673601660146557288999980121446607416674692876583762027139935596727123826407518096021547369275045756108019504547728660228811757349328191062211230954792707685874002632942441843714644403502273942182055404007256356990487212359705697654661936602760579646372792445091367967451677285533064555257520693340235124505269607245401539991045951744101543845443660197897103403404992492763853284861589205734809438139095697791958025189819762443744750897637572569926328355504544287665120754932761983261039049134747095142587974064883181623482701656829569086782734728221339035051875652864338522590020070281543971416810282330763624637401022934617700104134698570936867090715760802403189157701981022852524054252970887118457447923476826583464395590842455635964003554896687005304948791811829113211911125879352210974916167186754856728987336998705890579457015583334507877535471765147227650950348162419064978217940779348955772444498990503692635443590505589325405634755362529382391250431787925548793273908203697
 * 725601807566147894239315338229656642596971622027244458392825429933519367431426678618041041709799825424445525515515690552474843336421709821635175756615674757981724298701098167406067997691752000757885511180079549775469862913026560812398722084826473702362622130681206182264114298378654071759899041330895532806162768307493706662826637603889856227249516725450187422688983935341037196087261587676935235327197658644537525484512914783182239371837264428271493199805238619814137240223186480236749955184897317685148635407194440916922521227372130061799371911960863944126664144685418143603098310286041745051063951939935448215809635348701178007876067455568950976941973564428175423376224043408203323166796854252207944620988462513845351152939169434125314058021388513104279336856283346995155644628349501978148353912185102117961933413268161104228111516240415788020350253283575273901779438292682517511702605179776348495055389299534058112307245689589879287003861037115149414896364187201417308735987252683399031483031971662757918364550664451998779108716197847142858582558136251275646331135249147837231869334285961220416122665675053042486513179105464142694326916618259126576518554934940969947491769093926740362347216347460556295788473765889589230363657365032085341727354673559743080186825447159161342367869220857762291128331740405914463309594420193057206167115117446094320759249660771456974684703498529866350334003238678269563817006196354735009809788637449011623344052922224798903146538354811100630596741386750624649242978867463817250837911761677116438650217182006757928469353189695753083196438542054444411575224035786853756843280041405167387061278448057961856679700537126447618797770433226478531293002418107653614777610402937376494303694091281475879672597878904700923008271445565345160606016088354049434526626958089700273928591932454884129245151226176571968991501678050432987290794881787741321114347466828060460305175763336560861780325444401573592586053205381873940704432757489222179013297980752001432533952756399701929723751095205378958435282721092521199616720448398943260344221184664254553485147395865125221821072901144725375617124078177966477110987743070514466793231531802391527397851872899750777963010064934613664301045670244879506284148669783411636497886208983667354213114519012662476195355347034304467538717440845838683172640854188980148031620266102729801564947622983782858596465177651792469331516639604108232530502317935363637319933733747717732211028992484843132087931250904628114159726749160367247806320430537733954705155796945362252571980536126161207362205246613748757900816728075885941282340175895954151427468312306563754008224447724024271638586364482508036155020403390230311751289710615764318140766211728341172354476626859061070312929077161358234581690616817889245169125379798237041509559030677455813576240058043511884399298256678549137019947435851295486000695808684639638298941928233001391943531523678797425536222458835418778756834229397327446849744382679952746756327698777837019433832172454396735119086219101566438852355704014357721895555067031209348691812154120694729524423511221578212973410202891239080040522341398956943837902559690383924305455955950931650450341263170859758678933311478638891556425887737125434303366774433756360900899294536311571277756355911700519659425265430107489510452605584052317848740411830034664868302168061309533629174584759430463873661567559383695089768356560545300060966471529949192992671082830749165893129988072085726489534513244258974957719054182260483147639544451333947577350387129126943702549157687039696678367717371549663405949260537174663727348820095827726772443422315453764683188978526616749034415994808132233484340037918675221926257430035895838053269817069542249422062230221618710201620030339094790688619229213712231029901296516924343986614777483276397266591304206639243620529582951412701040927002997165245715952906753330403451413645205330222903690146420217494483021109889158977853764603431918000151570728483051177079055157719820502092877157650130587553540399434979869594122930139381470697288730175521828616160947835409042388517012819019537565552085006091543984627398933340092411325424482725086293081528976824809462069443163979694068203066433690286777978770841778806263816053977296930328370394052829256352107392585050190602507598431205230702168835769998187476065954197295883096405573059856938486510250091604655076922249484698798443497408505835787586993124850752972720770921618514193724613021782720695472648808674277930166699250560864875420525219135005927774494583479956444703146051381639676686725665044560626564803045215122962902773895506273137860492069746869005056980865870825387554720320008918224253853735332893724792721297169651801813842182920591078455821284086381846148864928027779810185986623802011582131813073164065500264971819010567568048185804308672408678247407403367910573905569147007476675364525513336131280025231921775173375448007795181179559299517478570463191636387096802138679494517244467809
 *
 * real	 0m1.184s
 * user	 0m1.176s
 * sys	  0m0.008s
 *
 */

#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>

int main(int argc, char **argv){

	if(argc != 3){
		fprintf(stdout,"\n./bigmult <number A> <number B>\n");
		return 1;
	}

	char *big_a,*big_b;
	// store the two numbers to multiplicate, big_b is always the longest (or equal)
	if(strlen(argv[1]) > strlen(argv[2])){
		big_b = argv[1];
		big_a = argv[2];
	}
	else{
		big_a = argv[1];
		big_b = argv[2];
	}

	char *null;
	int big_b_ptr_ref, big_b_ptr, big_a_ptr_ref, big_a_ptr, inter_result;

	int big_b_len = strlen(big_b);
	int big_a_len = strlen(big_a);

	int carry = 0;

	char *result;
	result = malloc((big_b_len + big_a_len) * sizeof(char));
	int result_ptr = 0;

	#ifdef DEBUG
	int i;
	for(i=strlen(big_a)-1; i >= 0; i--)
		fprintf(stdout, "%c", *(big_a+i));
	fprintf(stdout,"\nperforming %s (l=%d) x %s (l=%d)\n",
			big_a, (int)big_a_len, big_b, (int)big_b_len);
	#endif
   /* linear convolution
    * multiply digits one by one
    * starting from the rightmost ones
    * example:
    *               1   2   3
    *           ×   4   5   6
    *            -------------
    *              6   12  18
    *          5   10  15
    *      4   8   12
    *        -----------------
    *      4   13  28  27   18
    *    4+1 13+3 28+2 27+1  8
    *      5   6   0    8    8
	 */

	// loop over big_b digits from the right to the left
	for( big_b_ptr_ref = big_b_len -1 ; big_b_ptr_ref >= 0 ; big_b_ptr_ref--){
		inter_result = 0;
		big_b_ptr = big_b_ptr_ref;
		for(  big_a_ptr = (big_a_len - 1);
				big_b_ptr < big_b_len && big_a_ptr >= 0;
				big_b_ptr++){
			/* strtol will convert everything in memory until it finds a \0
			* so we need to make sure the variable passed to strtol contains only
			* the char we want, followed with a \0
			*/
			char c[2];
			c[1] = '\0';
			int a,b;
			c[0] = big_a[big_a_ptr];
			a = strtol(c, &null, 10);
			c[0] = big_b[big_b_ptr];
			b = strtol(c, &null, 10);
			inter_result += ( a * b );
			#ifdef DEBUG
			fprintf(stdout,"\t%d*%d=%d", a, b, (a * b));
			#endif
			big_a_ptr-- ;
		}

		// add previous carry
		#ifdef DEBUG
		fprintf(stdout," [sum = %d+%d=%d;",
				  inter_result, carry, inter_result + carry);
		#endif
		inter_result += carry;
		carry = inter_result / 10;
		inter_result %= 10;
		#ifdef DEBUG
		fprintf(stdout," keep = %d; carry = %d];",
				  inter_result,carry);
		#endif
		char c[5];
		c[4] = '\0';
		snprintf(c, sizeof(int), "%d", inter_result);
		result[result_ptr] = *c;
		result_ptr++;
		#ifdef DEBUG
		fprintf(stdout,"result= %s\n", result);
		#endif
	}

	#ifdef DEBUG
	fprintf(stdout,"leftmost reached, finished first loop\n");
	#endif

	// set the pointer to big_b to the leftmost position
	big_b_ptr_ref = 0;
	for( big_a_ptr_ref = big_a_len - 2 ; big_a_ptr_ref >= 0 ; big_a_ptr_ref--){
		inter_result = 0;
		big_b_ptr = big_b_ptr_ref;
		for(  big_a_ptr = big_a_ptr_ref;
				big_a_ptr >= 0 && big_b_ptr < big_b_len;
				big_b_ptr++){
			char c[2];
			c[1] = '\0';
			int a,b;
			c[0] = big_a[big_a_ptr];
			a = strtol(c, &null, 10);
			c[0] = big_b[big_b_ptr];
			b = strtol(c, &null, 10);
			inter_result += ( a * b );
			#ifdef DEBUG
			fprintf(stdout,"\t%d*%d=%d", a, b, (a * b));
			#endif
			big_a_ptr--;
		}

		// add previous carry
		#ifdef DEBUG
		fprintf(stdout," [sum = %d+%d=%d;",
				  inter_result, carry, inter_result + carry);
		#endif
		inter_result += carry;
		carry = inter_result / 10;
		inter_result %= 10;
		#ifdef DEBUG
		fprintf(stdout," keep = %d; carry = %d];",
				  inter_result,carry);
		#endif
		char c[5];
		c[4] = '\0';
		snprintf(c, sizeof(int), "%d", inter_result);
		result[result_ptr] = *c;
		result_ptr++;
		#ifdef DEBUG
		fprintf(stdout,"result= %s\n", result);
		#endif
	}

	#ifdef DEBUG
	fprintf(stdout,"carry = %d\n",carry);
	fprintf(stdout,"result= ");
	#endif
	if (carry > 0)
		fprintf(stdout, "%d",carry);
	for(result_ptr=(strlen(result)-1);result_ptr>=0;result_ptr--)
		fprintf(stdout,"%c",result[result_ptr]);

	fprintf(stdout,"\n");

	free(result);
	return 0;
}
